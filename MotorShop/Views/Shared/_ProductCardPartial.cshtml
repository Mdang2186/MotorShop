@model MotorShop.Models.Product

@{
    // Chọn ảnh chính: ưu tiên ImageUrl, nếu không có thì lấy ảnh đầu tiên trong Images
    var imgs = (Model.Images ?? Enumerable.Empty<MotorShop.Models.ProductImage>())
               .OrderBy(i => i.SortOrder)
               .ToList();

    var mainImg = !string.IsNullOrWhiteSpace(Model.ImageUrl)
        ? Url.Content(Model.ImageUrl)
        : (imgs.FirstOrDefault() != null
            ? Url.Content(imgs.First().ImageUrl)
            : Url.Content("~/images/placeholders/product.webp"));

    string Price(decimal x) => string.Format(
        System.Globalization.CultureInfo.GetCultureInfo("vi-VN"),
        "{0:N0} ₫", x);

    bool hasSale = Model.OriginalPrice.HasValue && Model.OriginalPrice.Value > Model.Price;
    var discount = hasSale
        ? Math.Round((1 - (Model.Price / Model.OriginalPrice.Value)) * 100)
        : 0;
}

<a asp-controller="Products"
   asp-action="Details"
   asp-route-id="@Model.Id"
   class="ms-card block rounded-2xl bg-white border border-slate-100 overflow-hidden hover:shadow-xl transition group">

    <div class="relative bg-slate-50">
        <img src="@mainImg"
             alt="@Model.Name"
             class="w-full h-44 object-cover group-hover:scale-[1.03] transition-transform duration-300" />

        @if (hasSale)
        {
            <span class="absolute top-2 left-2 px-2 py-1 rounded-full bg-rose-600 text-white text-[11px] font-semibold shadow">
                -@discount%
            </span>
        }
    </div>

    <div class="p-4 space-y-2">
        <h3 class="text-sm font-semibold text-slate-900 line-clamp-2">
            @Model.Name
        </h3>

        <div class="flex items-baseline gap-2">
            <span class="text-base font-bold text-blue-600">@Price(Model.Price)</span>
            @if (hasSale)
            {
                <span class="text-xs text-slate-400 line-through">
                    @Price(Model.OriginalPrice!.Value)
                </span>
            }
        </div>

        <p class="text-[11px] text-slate-400">
            Kho còn: @Model.StockQuantity chiếc
        </p>
    </div>
</a>
